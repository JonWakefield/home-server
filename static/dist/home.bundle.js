(()=>{function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var t,n,o=null,a=["png","jpeg","jpg","gif"],r=!1,l=window.innerWidth;l>=1920?n=9:l<1920&&l>=1280?n=6:(n=3,r=!0);var i,c,d,s,u,m="d-flex flex-wrap flex-md-nowrap align-items-center pt-4 pb-2 mb-3 border-bottom",p="file-spacing",h="file-label",f="list-group-item list-group-item-action py-3 lh-sm",v="d-flex w-100 align-items-center",y="text-body-secondary lp",E=document.getElementById("main"),b=(document.createElement("div"),document.getElementById("main"),!1),g=document.createElement("small");function C(){var a;d=document.getElementById("notification-banner"),s=document.getElementById("close-banner"),u=document.getElementById("notification-message"),s.addEventListener("click",(function(){d.classList.remove("show")})),document.getElementById("goBackButton").addEventListener("click",(function(){window.location.href="/"}));var r=document.getElementById("downloadFile"),l=document.getElementById("previewFile");c=document.getElementById("previewModal");var C=document.getElementsByClassName("btn-close")[3];i=document.getElementById("preview-container");var k,T,I=document.getElementById("renameFile"),S=document.getElementById("renameModal"),F=document.getElementById("renameForm"),j=document.getElementById("renameInput"),M=document.getElementById("renameError"),P=document.getElementById("oldFileName"),R=document.getElementsByClassName("btn-close")[0],H=document.getElementById("delFile"),U=document.getElementById("deleteModal"),z=document.getElementById("deleteForm"),O=document.getElementById("delError"),D=document.getElementsByClassName("btn-close")[1],q=document.getElementById("delFileName"),V=document.getElementById("delTitle"),G=document.getElementById("addFolder"),J=document.getElementById("addFolderModal"),_=document.getElementById("addFolderForm"),K=document.getElementById("addFolderErr"),Q=document.getElementsByClassName("btn-close")[2],W=document.getElementById("addFolderInput");function $(e){return!(!e||/[\\/:*?"<>|\s]/.test(e)||e.length>50)}function X(){var n=document.createElement("a"),o=document.createElement("div"),a=document.createElement("small"),r=document.createElement("small");n.className=f,o.className=v,a.className=y,r.className="lp lblue",a.textContent="Storage Used:";var l,i,c=function(e){var t=e.toString().length;return t<=5?["KB",e]:t>5&&t<=9?["MB",e=B(e,1e3)]:["GB",e=B(e,1e4)]}(t.total_storage),d=(i=2,function(e){if(Array.isArray(e))return e}(l=c)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,a,r,l,i=[],c=!0,d=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=r.call(n)).done)&&(i.push(o.value),i.length!==t);c=!0);}catch(e){d=!0,a=e}finally{try{if(!c&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(d)throw a}}return i}}(l,i)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(t,n):void 0}}(l,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=d[0],u=d[1];return r.textContent="".concat(u," ").concat(s),svg=function(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("xmlns",e),t.setAttribute("width","16"),t.setAttribute("height","16"),t.setAttribute("fill","currentColor"),t.setAttribute("class","bi bi-floppy2-fill"),t.setAttribute("viewBox","0 0 16 16");var n=document.createElementNS(e,"path");n.setAttribute("d","M12 2h-2v3h2z");var o=document.createElementNS(e,"path");return o.setAttribute("d","M1.5 0A1.5 1.5 0 0 0 0 1.5v13A1.5 1.5 0 0 0 1.5 16h13a1.5 1.5 0 0 0 1.5-1.5V2.914a1.5 1.5 0 0 0-.44-1.06L14.147.439A1.5 1.5 0 0 0 13.086 0zM4 6a1 1 0 0 1-1-1V1h10v4a1 1 0 0 1-1 1zM3 9h10a1 1 0 0 1 1 1v5H2v-5a1 1 0 0 1 1-1"),t.appendChild(n),t.appendChild(o),t}(),o.appendChild(svg),o.appendChild(a),o.appendChild(r),n.appendChild(o),n}r.addEventListener("click",(function(){!function(){if(file=o,!file)return u.textContent="Please select a file",void d.classList.add("show");var e=file.querySelector("label").textContent,t=L("path"),n=encodeURIComponent("".concat(t,"/").concat(e)),a="/api/downloadFile?path=".concat(n);fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.ok?e.blob():(u.textContent="HTTP Error: "+e.statusText,void d.classList.add("show"))})).then((function(t){N(t,e)})).catch((function(e){console.error("Error received: ",e)}))}()})),l.addEventListener("click",(function(){A()})),C.onclick=function(){c.style.display="none"},G.onclick=function(){J.style.display="block"},Q.onclick=function(){J.style.display="none",K.textContent="",K.style.display="none"},H.onclick=function(){if(!o)return u.textContent="Please select a file",void d.classList.add("show");b=!1,V.textContent="Delete File?",q.textContent=o.querySelector("label").textContent,U.style.display="block"},D.onclick=function(){U.style.display="none",O.textContent="",O.style.display="none"},I.onclick=function(){if(!o)return u.textContent="Please select a file",void d.classList.add("show");P.textContent=o.querySelector("label").textContent,S.style.display="block"},R.onclick=function(){S.style.display="none",M.textContent="",M.style.display="none"},window.onclick=function(e){e.target==S?(S.style.display="none",M.textContent="",M.style.display="none"):e.target==U?(U.style.display="none",O.textContent="",O.style.display="none"):e.target==J?(J.style.display="none",K.textContent="",K.style.display="none"):e.target==c&&(c.style.display="none")},_.addEventListener("submit",(function(e){e.preventDefault();var t=W.value;if(!$(t))return K.textContent="Invalid Folder Name",void(K.style.display="block");var n=L("path"),o="/api/addFolder?path=".concat(n),a={Name:t};fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(e){return e.ok?e.json():(K.textContent="HTTP Error: "+e.statusText,void(K.style.display="block"))})).then((function(e){if(!e.created)return K.textContent="Folder already Exists",void(K.style.display="block");window.location.reload()})).catch((function(e){console.error("Error received: ",e),u.textContent="Error Received: "+e,d.classList.add("show")}))})),z.addEventListener("submit",(function(e){var t,n,o;e.preventDefault(),b?fetch("/api/deleteAccount",{method:"DELETE",headers:{"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():(q.textContent="HTTP Error: "+e.statusText,void(q.style.display="block"))})).then((function(e){window.location.href="/"})).catch((function(e){u.textContent="Error Received: "+e,d.classList.add("show")})):(t=q.textContent,n=L("path"),o="/api/deleteFile?path=".concat(n,"/").concat(t),fetch(o,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(!e.success)return q.textContent=e.message,void(q.style.display="block");U.style.display="none",O.style.display="none",window.location.reload()})).catch((function(e){u.textContent="Error Received: "+e,d.classList.add("show")})))})),F.addEventListener("submit",(function(e){e.preventDefault();var t=P.textContent,n=j.value;if(!$(n))return M.textContent="Invalid File Name",void(M.style.display="block");!function(e,t,n){e.preventDefault();var o=w(t);"dir"!=o&&(n=n+"."+o);var a=L("path"),r="/api/renameFile?path=".concat(a),l={newFileName:n,fileName:t};fetch(r,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then((function(e){return e.ok?e.json():(M.textContent="HTTP Error: "+e.statusText,void(M.style.display="block"))})).then((function(e){e&&window.location.reload()})).catch((function(e){console.error("Error received: ",e),u.textContent="Error Received: "+e,d.classList.add("show")}))}(e,t,n)})),document.getElementById("fileUpload").addEventListener("change",(function(e){var t=e.target.files;if(t.length>0){var n=t[0],o=new FormData;o.append("file",n);var a=L("path"),r="/api/uploadFile?path=".concat(a);fetch(r,{method:"POST",body:o}).then((function(e){return e.ok?e.json():(u.textContent="Error Received: "+e.statusText,void d.classList.add("show"))})).then((function(e){window.location.reload()})).catch((function(e){console.error("Error: ",e),u.textContent="Error Received: "+e,d.classList.add("show")}))}})),fetch("/api/getUserInfo",{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.ok||(u.textContent="Failed to retrieve content "+e.statusText,d.classList.add("show")),e.json()})).then((function(e){t=e.user_info,function(){document.getElementById("nameSpan").innerText=t.name;var e,n,o=document.getElementById("userListGroup");pathPanel=(e=document.createElement("a"),n=document.createElement("div"),e.className=f,n.className=v,svg=function(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("xmlns",e),t.setAttribute("width","16"),t.setAttribute("height","16"),t.setAttribute("fill","currentColor"),t.setAttribute("class","bi bi-compass"),t.setAttribute("viewBox","0 0 16 16");var n=document.createElementNS(e,"path");n.setAttribute("d","M8 16.016a7.5 7.5 0 0 0 1.962-14.74A1 1 0 0 0 9 0H7a1 1 0 0 0-.962 1.276A7.5 7.5 0 0 0 8 16.016m6.5-7.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0");var o=document.createElementNS(e,"path");return o.setAttribute("d","m6.94 7.44 4.95-2.83-2.83 4.95-4.949 2.83 2.828-4.95z"),t.appendChild(n),t.appendChild(o),t}(),n.appendChild(svg),n.appendChild(g),e.appendChild(n),e),storagePanel=X(),deleteAccPanel=function(){var e=document.createElement("a");a=e;var t=document.createElement("div"),n=document.createElement("small");return e.className=f,t.className=v,n.className="lp lred",n.textContent="Delete Account",svg=function(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("xmlns",e),t.setAttribute("width","16"),t.setAttribute("height","16"),t.setAttribute("fill","currentColor"),t.setAttribute("class","bi bi-person-x"),t.setAttribute("viewBox","0 0 16 16"),t.setAttribute("class","lred");var n=document.createElementNS(e,"path");n.setAttribute("d","M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m.256 7a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z");var o=document.createElementNS(e,"path");return o.setAttribute("d","M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m-.646-4.854.646.647.646-.647a.5.5 0 0 1 .708.708l-.647.646.647.646a.5.5 0 0 1-.708.708l-.646-.647-.646.647a.5.5 0 0 1-.708-.708l.647-.646-.647-.646a.5.5 0 0 1 .708-.708"),t.appendChild(n),t.appendChild(o),t}(),t.appendChild(svg),t.appendChild(n),e.appendChild(t),e}(),o.appendChild(pathPanel),o.appendChild(storagePanel),o.appendChild(deleteAccPanel)}(),a.onclick=function(){V.textContent="Delete Account?",q.textContent="This will delete all files and folders",U.style.display="block",b=!0}})).catch((function(e){console.error("Error: ",e)})),k=L("path"),T="/api/getDirContent?path=".concat(k),fetch(T,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){if(!e.ok)throw new Error("Failed to retrieve content ",e.statusText);return e.json()})).then((function(e){var t;!function(e){var t,a,r=0;Object.keys(e).forEach((function(o){r%n==0&&(0!=r&&E.appendChild(a),a=function(){var e=document.createElement("div");return e.className=m,e}());var l=e[o],i=o,c=function(){var e=document.createElement("div");return e.className=p,e}(),d=function(){var e=document.createElement("label");return e.className=h,e}();if(d.textContent=i,l)t=function(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("xmlns",e),t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("fill","currentColor"),t.setAttribute("class","bi-file"),t.setAttribute("viewBox","0 0 16 16");var n=document.createElementNS(e,"path");return n.setAttribute("d","M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a2 2 0 0 1 .342-1.31zM2.19 4a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91h10.348a1 1 0 0 0 .995-.91l.637-7A1 1 0 0 0 13.81 4zm4.69-1.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139q.323-.119.684-.12h5.396z"),t.appendChild(n),t}(),c.classList.add("folder");else{var s=x(w(i));t="image"===s?function(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("xmlns",e),t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("fill","currentColor"),t.setAttribute("class","bi-file"),t.setAttribute("viewBox","0 0 16 16");var n=document.createElementNS(e,"path");n.setAttribute("d","M6.502 7a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3");var o=document.createElementNS(e,"path");return o.setAttribute("d","M14 14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zM4 1a1 1 0 0 0-1 1v10l2.224-2.224a.5.5 0 0 1 .61-.075L8 11l2.157-3.02a.5.5 0 0 1 .76-.063L13 10V4.5h-2A1.5 1.5 0 0 1 9.5 3V1z"),t.appendChild(n),t.appendChild(o),t}():function(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("xmlns",e),t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("fill","currentColor"),t.setAttribute("class","bi-file"),t.setAttribute("viewBox","0 0 16 16");var n=document.createElementNS(e,"path");n.setAttribute("d","M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5");var o=document.createElementNS(e,"path");return o.setAttribute("d","M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"),t.appendChild(n),t.appendChild(o),t}(),c.classList.add("file")}c.appendChild(t),c.appendChild(d),a.appendChild(c),r++}));try{E.appendChild(a),document.querySelectorAll(".file-spacing").forEach((function(e){e.addEventListener("click",(function(){o&&o.classList.remove("selected-file"),e.classList.add("selected-file"),o=e}))})),document.querySelectorAll(".file").forEach((function(e){e.addEventListener("click",(function(){o&&o.classList.remove("selected-file"),e.classList.add("selected-file"),o=e})),e.addEventListener("dblclick",(function(){A()}))})),document.querySelectorAll(".folder").forEach((function(e){e.addEventListener("dblclick",(function(){var t,n=e.querySelector("label").textContent,o=L("path");t=".."===n?function(e){for(var t=0,n=e.length-1;n>=0;n--)if("/"===e[n]){t=n;break}return e.slice(0,t)}(o):o+"/"+n,window.location.href="".concat(window.location.pathname,"?path=").concat(encodeURIComponent(t))}))}))}catch(e){console.error("Error received: ",e)}}(e.files),t=L("path"),g.textContent="/"+t})).catch((function(e){console.error("Error: ",e)}))}function w(e){for(var t="",n=e.length-1;n>=0&&"."!==e[n];n--)t+=e[n];return t.length===e.length?"dir":t.split("").reverse().join("")}function x(e){return"dir"===e?"":a.includes(e)?"image":"text"}function A(){if(file=o,!file)return u.textContent="Select a file to display",void d.classList.add("show");var e=file.querySelector("label").textContent,t=x(w(e));if(!t)return u.textContent="Can not open a preview for files of this type",void d.classList.add("show");var n=L("path"),a="/api/previewFile?path=".concat(n,"/").concat(e);fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.ok?e.blob():(u.textContent="HTTP Error: "+e.statusText,void d.classList.add("show"))})).then((function(n){var o,a,l,d;"image"===t?(i.innerHTML="",c.style.display="block",l=n,(d=document.createElement("img")).className="preview-image",d.src=URL.createObjectURL(l),i.appendChild(d)):"text"===t&&(r?N(n,e):(i.innerHTML="",c.style.display="block",o=n,(a=document.createElement("iframe")).className="preview-iframe",a.src=URL.createObjectURL(o),i.appendChild(a)))})).catch((function(e){console.error("Error: ",e)}))}function L(e){return new URLSearchParams(window.location.search).get(e)}function B(e,t){return(e/t).toFixed(2)}function N(e,t){var n=window.URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)}g.className=y,document.addEventListener("DOMContentLoaded",(function(e){C()}))})();